# Lab7 快速参考卡

## 项目信息
- **项目名称**: 频率测量与控制系统
- **目标板卡**: EGO1 FPGA开发板
- **系统时钟**: 100MHz
- **FPGA器件**: Artix-7 (XC7A35T-CPG236或类似)

## 核心功能
1. 频率测量：0~9999 Hz（测频法，1秒窗口）
2. 数码管显示：4位十进制
3. DAC控制：8位拨码开关→DAC0832→NE555

## 模块清单

### 源文件 (src/)
| 模块 | 文件名 | 功能 | 代码行数 |
|-----|--------|------|---------|
| 时钟分频 | clk_div.v | 生成1Hz/1kHz/100Hz时钟 | ~75行 |
| 频率测量 | freq_meter.v | 测频法频率测量 | ~80行 |
| DAC控制 | dac_ctrl.v | DAC0832控制逻辑 | ~90行 |
| 显示驱动 | display_driver.v | 4位数码管驱动 | ~110行 |
| 顶层模块 | top.v | 系统集成 | ~100行 |

### 约束文件
- `lab7.xdc` - Vivado约束文件 (~140行)

### 文档
- `README.md` - 项目概述和基本使用说明
- `USAGE_GUIDE.md` - 详细上板指南和故障排查
- `request.md` - 实验要求原文

### 仿真文件 (sim/)
- `tb_freq_meter.v` - 频率测量模块测试台

## 关键参数

### 时钟频率
- 系统时钟: 100 MHz
- 测量窗口: 1 Hz (1秒)
- 扫描时钟: 1 kHz (数码管)
- 消抖时钟: 100 Hz (未使用)

### 测量规格
- 测量范围: 0~65535 Hz (内部)
- 显示范围: 0~9999 Hz
- 测量精度: ±1 Hz
- 更新速率: 1 Hz

### 硬件接口

#### 输入
- `clk` (P17): 100MHz系统时钟
- `rst` (P15): 复位按键S6（高有效）
- `signal_in` (M2*): NE555信号输入
- `sw[7:0]`: 8位拨码开关（SW0~SW7）

*注：M2为示例引脚，需根据实际硬件确认

#### 输出
- `an[7:0]`: 数码管位选（高有效）
- `seg0[7:0]`: 右侧段选（高有效）
- `seg1[7:0]`: 左侧段选（高有效，本项目未使用）
- `dac_data[7:0]`: DAC数据线
- `dac_wr1`: DAC写使能1（低有效）
- `dac_wr2`: DAC写使能2（低有效）
- `dac_cs`: DAC片选（低有效）
- `led[3:0]`: LED状态指示

### LED指示说明
- LED0: 测量窗口指示（1Hz切换）
- LED1: 输入信号指示
- LED2: 频率 > 1kHz
- LED3: 频率 > 5kHz

## 快速开始

### 1. Vivado工程设置
```
1. 新建工程，选择目标器件
2. 添加src/下所有.v文件
3. 设置top.v为顶层
4. 添加lab7.xdc约束文件
5. 修改约束文件中的signal_in引脚（第33行）
```

### 2. 硬件连接
```
NE555输出 → [100Ω电阻] → FPGA信号输入
FPGA拨码开关 → DAC0832数据输入
DAC0832输出 → NE555控制电压（Pin 5）
```

### 3. 验证步骤
```
1. 下载比特流
2. 观察数码管显示"0000"
3. 连接1kHz信号源
4. 数码管应显示约"1000"
5. 调节拨码开关，观察频率变化
```

## 常见问题速查

| 现象 | 可能原因 | 解决方法 |
|-----|---------|---------|
| 数码管不显示 | 引脚错误 | 检查约束文件 |
| 显示乱码 | 段码极性反 | 确认共阴极、高有效 |
| 频率不准 | 时钟频率错 | 确认100MHz时钟 |
| 数字乱跳 | 信号干扰 | 增加限流电阻，改善接地 |
| DAC无效 | 接线错误 | 检查WR1/WR2/CS极性 |

## 重要提示

⚠️ **必须做的事：**
1. 信号输入必须串联100Ω限流电阻
2. 上板前确认signal_in引脚分配
3. 检查DAC接线极性（WR1/WR2/CS低有效）
4. 确认所有信号电压≤3.3V

❌ **禁止做的事：**
1. 不要直接连接高电平信号到FPGA
2. 不要在通电状态下插拔连接线
3. 不要忽略约束文件中的引脚警告

## 文件统计
- Verilog源文件: 5个
- 约束文件: 1个
- 测试台: 1个
- 文档: 3个
- 总代码行数: ~455行
- 总文档字数: ~8000字

## 项目状态
✅ 代码完成并通过审查  
✅ 文档完整  
✅ 可直接综合  
⏳ 待硬件验证（需确认引脚）

## 联系与支持
- 仓库: Origin0804/Digital-electricity-experiments-verilog
- 路径: Lab_7/
- 更新日期: 2025-12-16

---
**版本**: v1.0  
**创建日期**: 2025-12-16  
**最后更新**: 2025-12-16
